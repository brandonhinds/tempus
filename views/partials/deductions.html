<section class="ts-card" id="page-deductions" style="display:none;">
  <div class="ts-toolbar" style="margin-bottom:12px;">
    <div class="ts-gap-md" style="display:flex; align-items:center;">
      <h3 style="margin:0;">Income Deductions</h3>
      <span class="ts-note" id="deduction-company-disabled-note" style="display:none;">Company tracking disabled ‚Äî company deductions read-only.</span>
    </div>
    <div class="ts-gap-sm" style="display:flex; align-items:center;">
      <button class="ghost" id="btn-manage-deduction-categories" style="display:none;">Manage categories</button>
      <button id="btn-add-deduction">Add deduction</button>
    </div>
  </div>
  <div class="ts-note" style="margin-bottom:12px;">Configure salary sacrifice items, company deductions, and extra super contributions. Recurring deductions display the next five run dates for confirmation.</div>
  <div class="ts-toolbar" id="deduction-category-collapse-controls" style="display:none; margin-bottom:12px;">
    <div class="ts-note" style="margin:0;">Categories are collapsed by default. Expand to review individual deductions.</div>
    <div class="ts-gap-sm" style="display:flex;">
      <button class="ghost small" id="btn-expand-all-deduction-categories">Expand all</button>
      <button class="ghost small" id="btn-collapse-all-deduction-categories">Collapse all</button>
    </div>
  </div>
  <div id="deductions-empty" class="ts-empty-state" style="display:none;">
    <div class="ts-empty-state__icon">üì≠</div>
    <p class="ts-empty-state__title">No deductions yet</p>
    <p class="ts-empty-state__text">Use <strong>Add deduction</strong> to configure salary sacrifice, company expenses, or extra super contributions.</p>
  </div>
  <div class="ts-list" id="deductions-list"></div>
</section>

<div class="ts-modal" id="modal-deduction-form" style="display:none;">
  <div class="ts-modal-content" style="max-width:720px;">
    <div class="ts-modal-header">
      <h3 id="deduction-form-title">Add deduction</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <div class="ts-grid ts-grid--gap-md ts-grid--align-start" style="margin-top:0;">
        <div class="ts-col-span-6">
          <label for="deduction-name">Name</label>
          <input id="deduction-name" placeholder="e.g. Novated lease" />
        </div>
        <div class="ts-col-span-3" style="max-width:220px;">
          <label for="deduction-type">Type</label>
          <select id="deduction-type">
            <option value="standard">Standard deduction</option>
            <option value="extra_super">Extra super contribution</option>
          </select>
        </div>
        <div class="ts-col-span-3" style="max-width:220px;" id="deduction-category-column">
          <label for="deduction-category">Category</label>
          <select id="deduction-category">
            <option value="">Uncategorised</option>
          </select>
          <div class="ts-empty-state ts-empty-state--inline" id="deduction-category-empty-note" style="display:none;">
            <div class="ts-empty-state__icon">üè∑Ô∏è</div>
            <p class="ts-empty-state__title">No categories yet</p>
            <p class="ts-empty-state__text">Create categories to organise deductions for reports like BAS and invoices.</p>
          </div>
        </div>
      </div>
      <div class="ts-grid ts-grid--gap-md" style="margin-top:12px;">
        <div class="ts-col-span-4" style="max-width:260px;">
          <div id="deduction-amount-wrapper">
            <label for="deduction-amount">Amount</label>
            <input type="number" id="deduction-amount" min="0" step="0.01" />
          </div>
          <div id="deduction-percent-wrapper" style="display:none; margin-top:12px;">
            <label for="deduction-percent">Percentage of gross income</label>
            <input type="number" id="deduction-percent" min="0" max="100" step="0.1" placeholder="e.g. 2" />
          </div>
          <div id="deduction-amount-mode-wrapper" style="display:none; margin-top:12px;">
            <label for="deduction-amount-mode">Calculation</label>
            <select id="deduction-amount-mode">
              <option value="flat">Flat amount</option>
              <option value="percent">Percentage of gross income</option>
            </select>
          </div>
        </div>
        <div class="ts-col-span-4" id="deduction-gst-wrapper" style="max-width:220px; display:flex; flex-direction:column; align-items:center;">
          <label for="deduction-gst" style="margin-bottom:4px;">Amount includes GST</label>
          <label class="ts-toggle">
            <input type="checkbox" id="deduction-gst" />
            <span class="ts-toggle-track"><span class="ts-toggle-thumb"></span></span>
          </label>
        </div>
        <div class="ts-col-span-4" id="deduction-company-wrapper" style="max-width:220px; display:none; flex-direction:column; align-items:center;">
          <label for="deduction-company-expense" style="margin-bottom:4px;">Company expense</label>
          <label class="ts-toggle">
            <input type="checkbox" id="deduction-company-expense" />
            <span class="ts-toggle-track"><span class="ts-toggle-thumb"></span></span>
          </label>
        </div>
      </div>
      <div id="deduction-company-gst-note" class="ts-note" style="margin-top:4px; display:none;">GST component is tracked automatically when company expenses are enabled.</div>
      <div class="ts-grid ts-grid--gap-md" style="margin-top:12px;">
        <div class="ts-col-span-4" style="max-width:220px;">
          <label for="deduction-frequency">Frequency</label>
          <select id="deduction-frequency">
            <option value="once">One-off</option>
            <option value="weekly">Weekly</option>
            <option value="fortnightly">Fortnightly</option>
            <option value="monthly">Monthly</option>
            <option value="quarterly">Quarterly</option>
            <option value="yearly">Yearly</option>
          </select>
        </div>
        <div class="ts-col-span-4" style="max-width:220px;">
          <label for="deduction-start-date">Start date</label>
          <input type="date" id="deduction-start-date" />
        </div>
        <div class="ts-col-span-4" style="max-width:220px;" id="deduction-end-date-wrapper">
          <label for="deduction-end-date">End date (optional)</label>
          <input type="date" id="deduction-end-date" />
        </div>
      </div>
      <div class="ts-note" id="deduction-occurrence-preview" style="margin-top:8px;">&nbsp;</div>
      <div class="ts-grid ts-grid--gap-md" style="margin-top:12px;">
        <div class="ts-col-span-12">
          <label for="deduction-notes">Notes (optional)</label>
          <textarea id="deduction-notes" rows="3" placeholder="Add context for this deduction"></textarea>
        </div>
      </div>
      <div class="ts-note" style="margin-top:12px;">Need to store documents for this deduction? We‚Äôll add file attachments soon.</div>
    </div>
    <div class="ts-modal-footer">
      <button class="ghost" id="btn-cancel-deduction">Cancel</button>
      <button id="btn-save-deduction">Save deduction</button>
    </div>
  </div>
</div>

<div class="ts-modal" id="modal-deduction-categories" style="display:none;">
  <div class="ts-modal-content" style="max-width:640px;">
    <div class="ts-modal-header">
      <h3>Manage deduction categories</h3>
      <div class="ts-gap-sm" style="display:flex; align-items:center;">
        <button class="ghost small" id="btn-add-deduction-category">Add category</button>
        <button class="ts-modal-close">&times;</button>
      </div>
    </div>
    <div class="ts-modal-body">
      <div id="deduction-category-list-wrapper">
        <div class="ts-note" style="margin-bottom:12px;">Categories appear on the deduction form when the feature flag is enabled. "Uncategorised" is always available.</div>
        <div class="ts-list" id="deduction-category-list"></div>
        <div class="ts-empty-state ts-empty-state--inline" id="deduction-category-empty-state" style="display:none;">
          <div class="ts-empty-state__icon">üóÉÔ∏è</div>
          <p class="ts-empty-state__title">No custom categories</p>
          <p class="ts-empty-state__text">Add your first category to group similar deductions together.</p>
        </div>
      </div>
      <div id="deduction-category-form-wrapper" style="display:none;">
        <div class="ts-grid ts-grid--gap-md" style="margin-top:0;">
          <div class="ts-col-span-8">
            <label for="deduction-category-name">Name</label>
            <input id="deduction-category-name" placeholder="e.g. Tools, Office supplies" />
          </div>
          <div class="ts-col-span-4" style="max-width:160px;">
            <label for="deduction-category-color">Color</label>
            <input type="color" id="deduction-category-color" value="#6b7280" />
          </div>
        </div>
        <div class="ts-note" style="margin-top:12px;">Colors reuse the same palette as hour types to keep visualisations consistent.</div>
      </div>
    </div>
    <div class="ts-modal-footer" id="deduction-category-list-footer">
      <button class="ghost" id="btn-close-deduction-categories">Close</button>
    </div>
    <div class="ts-modal-footer" id="deduction-category-form-footer" style="display:none;">
      <button class="ghost" id="btn-cancel-deduction-category">Cancel</button>
      <button id="btn-save-deduction-category">Save category</button>
    </div>
  </div>
</div>

<!-- Split Deduction Decision Modal -->
<div class="ts-modal" id="modal-split-deduction" style="display:none;">
  <div class="ts-modal-content" style="max-width:600px;">
    <div class="ts-modal-header">
      <h3>Edit Recurring Deduction</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <div class="ts-note" style="margin-bottom:16px; padding:12px; background:var(--warning)20; border-left:3px solid var(--warning);">
        ‚ö†Ô∏è This deduction has occurrences in the past. How would you like to proceed?
      </div>

      <label style="display:block; margin-bottom:24px; padding:12px; border:2px solid var(--border); border-radius:8px; cursor:pointer;">
        <input type="radio" name="split-decision" value="split" checked>
        <div style="margin-left:28px; margin-top:8px;">
          <strong>Split into past and future (Recommended)</strong>
          <div class="ts-note" style="margin-top:4px;">
            ‚Ä¢ Past: Keeps current settings (preserves history)<br>
            ‚Ä¢ Future: Your new settings apply<br>
            ‚Ä¢ All adjustments are preserved
          </div>
        </div>
      </label>

      <label style="display:block; margin-bottom:16px; padding:12px; border:2px solid var(--border); border-radius:8px; cursor:pointer;">
        <input type="radio" name="split-decision" value="override">
        <div style="margin-left:28px; margin-top:8px;">
          <strong>Override all occurrences (Advanced)</strong>
          <div class="ts-note" style="margin-top:4px; color:var(--warning);">
            ‚ö†Ô∏è Warning: This will:<br>
            ‚Ä¢ Change historical data<br>
            ‚Ä¢ Delete all occurrence adjustments<br>
            ‚Ä¢ Affect past reports
          </div>
        </div>
      </label>
    </div>
    <div class="ts-modal-footer">
      <button class="ghost" id="btn-cancel-split">Cancel</button>
      <button id="btn-confirm-split">Continue</button>
    </div>
  </div>
</div>
