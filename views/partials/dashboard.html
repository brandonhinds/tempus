<section class="ts-card" id="page-time" style="margin-bottom:16px;">
  <div class="ts-tabs">
    <div class="ts-tab active" data-tab="manual">Basic</div>
    <div class="ts-tab" data-tab="punch">Advanced</div>
  </div>

  <div id="tab-manual">
    <div class="ts-grid ts-grid--gap-md ts-grid--align-start">
      <div class="ts-col-span-4"><label>Date</label><input type="date" id="manual-date" /></div>
      <div class="ts-col-span-4" id="manual-hour-type-col" style="display:none;">
        <label>Hour Type</label>
        <select id="manual-hour-type"></select>
      </div>
      <div class="ts-col-span-4">
        <label>Contract</label>
        <select id="manual-contract"></select>
        <div class="ts-warning" id="manual-contract-warning" style="display:none;">No valid contract for this date. Add one on the Contracts page before logging time.</div>
      </div>
    </div>
    <div class="ts-grid ts-grid--gap-md" style="margin-top:8px;">
      <div class="ts-col-span-4">
        <label>Total hours</label>
        <input type="number" id="manual-hours" min="0" step="0.01" placeholder="" />
      </div>
    </div>
    <div style="margin-top:8px; display:flex; justify-content:space-between; align-items:center;">
      <div class="ts-gap-md" style="display:flex;">
        <button class="ghost" id="btn-create-manual-default" style="display:none;">Create Default</button>
        <button class="ghost" id="btn-enter-manual-default" style="display:none;">Enter Default</button>
        <button class="ghost" id="btn-edit-manual-defaults" style="display:none;">Edit Defaults</button>
      </div>
      <div class="ts-gap-md" style="display:flex;">
        <button class="ghost" id="btn-cancel-edit" style="display:none;">Cancel Edit</button>
        <button class="ghost" id="btn-delete-manual" style="display:none;">Delete Entry</button>
        <button id="btn-add-manual">Add Entry</button>
      </div>
    </div>
  </div>

  <div id="tab-punch" style="display:none;">
    <div class="ts-grid ts-grid--gap-md ts-grid--align-start">
      <div class="ts-col-span-4"><label>Date</label><input type="date" id="punch-date" /></div>
      <div class="ts-col-span-4" id="punch-hour-type-col" style="display:none;">
        <label>Hour Type</label>
        <select id="punch-hour-type"></select>
      </div>
      <div class="ts-col-span-4">
        <label>Contract</label>
        <select id="punch-contract"></select>
        <div class="ts-warning" id="punch-contract-warning" style="display:none;">No valid contract for this date. Add one on the Contracts page before logging time.</div>
      </div>
    </div>
    <div class="ts-note" id="punch-summary" style="margin-top:8px;"></div>
    <div class="ts-warning" id="punch-open-warning" style="display:none; margin-top:4px;"></div>
    <div class="ts-note" id="punch-suggestion" style="display:none; margin-top:4px; color: var(--success);"></div>
    <div id="punch-range-list" class="ts-punch-list"></div>
    <div style="margin-top:8px; display:flex; justify-content:space-between; align-items:center;">
      <div class="ts-gap-sm" style="display:flex;">
        <button class="ghost" id="btn-create-punch-default" style="display:none;">Create Default</button>
        <button class="ghost" id="btn-enter-punch-default" style="display:none;">Enter Default</button>
        <button class="ghost" id="btn-edit-punch-defaults" style="display:none;">Edit Defaults</button>
      </div>
      <div class="ts-gap-sm" style="display:flex; flex-wrap:wrap; gap:8px;">
        <button id="btn-punch-toggle">Punch In</button>
        <button class="ghost" id="btn-punch-cancel" style="display:none;">Discard Changes</button>
        <button class="ghost" id="btn-delete-punch" style="display:none;">Delete Entry</button>
        <button id="btn-punch-save">Add Entry</button>
      </div>
    </div>
  </div>

  <div class="ts-calendar" id="calendar-section">
    <div class="ts-calendar-header">
      <div style="display:flex; align-items:center; gap:16px;">
        <h3 style="margin:0;">Calendar</h3>
        <button class="ts-badge ts-hour-types-badge" id="calendar-month-total" type="button" aria-expanded="false">Total hours: 0</button>
        <button class="ts-badge ts-income-badge" id="calendar-net-income" type="button" aria-expanded="false">Net income: --</button>
        <button class="ts-badge ts-expected-badge" id="calendar-expected-hours" type="button" aria-expanded="false" style="display:none;">Projected variance: --</button>
      </div>
      <div style="display:flex; align-items:center; gap:12px;">
        <button class="ghost" id="calendar-filter-toggle" style="display:none;" title="Filter hour types">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M1 3h14M3 8h10M5 13h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </button>
        <div class="ts-calendar-nav">
          <button class="ghost" id="calendar-prev" title="Previous Month">◀</button>
          <button class="ghost" id="calendar-jump" title="Jump to Month" style="min-width:140px; text-align:center; padding:10px 14px;">
            <div id="calendar-label"></div>
          </button>
          <button class="ghost" id="calendar-next" title="Next Month">▶</button>
        </div>
      </div>
    </div>
    <div class="ts-calendar-filter-panel" id="calendar-filter-panel" style="display:none;">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
        <span style="font-weight:600;">Filter Hour Types</span>
        <div style="display:flex; gap:8px;">
          <button class="ghost" id="filter-select-all" style="font-size:12px; padding:4px 8px;">All</button>
          <button class="ghost" id="filter-select-none" style="font-size:12px; padding:4px 8px;">None</button>
          <button class="ghost" id="filter-select-income" style="font-size:12px; padding:4px 8px;">Income Only</button>
        </div>
      </div>
      <div id="calendar-filter-list" class="ts-calendar-filter-list"></div>
    </div>
    <div class="ts-hour-types-breakdown" id="hour-types-breakdown" hidden>
      <div id="hour-types-breakdown-list"></div>
    </div>
    <div class="ts-income-breakdown" id="income-breakdown" hidden>
      <div class="ts-income-row" id="income-invoice-total-row" hidden>
        <span class="ts-income-row-label">Invoice total</span>
        <span class="ts-income-row-actual"></span>
        <span class="ts-income-row-est" id="income-invoice-total">--</span>
      </div>
      <div class="ts-income-row" id="income-company-income-row" hidden>
        <span class="ts-income-row-label">Company income</span>
        <span class="ts-income-row-actual"></span>
        <span class="ts-income-row-est" id="income-company-income">--</span>
      </div>
      <div class="ts-income-row" id="income-company-expenses-row" hidden>
        <span class="ts-income-row-label">Company expenses</span>
        <span class="ts-income-row-actual"><button class="ghost small" id="btn-company-expenses-details" style="font-size:11px; padding:2px 8px;">Click for details</button></span>
        <span class="ts-income-row-est" id="income-company-expenses">--</span>
      </div>
      <div class="ts-income-row">
        <span class="ts-income-row-label">Gross income</span>
        <span class="ts-income-row-actual" id="income-actual-gross-value"></span>
        <span class="ts-income-row-est" id="income-gross">--</span>
      </div>
      <div class="ts-income-row">
        <span class="ts-income-row-label">Superannuation guarantee</span>
        <span class="ts-income-row-actual"></span>
        <span class="ts-income-row-est" id="income-super-guarantee">--</span>
      </div>
      <div class="ts-income-row">
        <span class="ts-income-row-label">Extra super contributions</span>
        <span class="ts-income-row-actual"></span>
        <span class="ts-income-row-est" id="income-extra-super">--</span>
      </div>
      <div class="ts-income-row">
        <span class="ts-income-row-label">Superannuation total</span>
        <span class="ts-income-row-actual" id="income-actual-super-value"></span>
        <span class="ts-income-row-est" id="income-super-total">--</span>
      </div>
      <div class="ts-income-row">
        <span class="ts-income-row-label">Pre-tax deductions</span>
        <span class="ts-income-row-actual"><button class="ghost small" id="btn-deductions-details" style="font-size:11px; padding:2px 8px;">Click for details</button></span>
        <span class="ts-income-row-est" id="income-other-deductions">--</span>
      </div>
      <div class="ts-income-row" id="income-super-lost-row" hidden>
        <span class="ts-income-row-label">Super lost due to deductions</span>
        <span class="ts-income-row-actual"></span>
        <span class="ts-income-row-est" id="income-super-lost">--</span>
      </div>
      <div class="ts-income-row">
        <span class="ts-income-row-label">Taxable income</span>
        <span class="ts-income-row-actual"></span>
        <span class="ts-income-row-est" id="income-taxable">--</span>
      </div>
      <div class="ts-income-row">
        <span class="ts-income-row-label">Tax</span>
        <span class="ts-income-row-actual" id="income-actual-tax-value"></span>
        <span class="ts-income-row-est" id="income-tax">--</span>
      </div>
      <div class="ts-income-row">
        <span class="ts-income-row-label">Net income</span>
        <span class="ts-income-row-actual" id="income-actual-net-value"></span>
        <span class="ts-income-row-est" id="income-net">--</span>
      </div>
      <div class="ts-income-divider ts-expected-breakdown income-potential-row" id="potential-net-divider" hidden></div>
      <div class="ts-income-row income-potential-row" id="income-projections-header" hidden>
        <div style="grid-column: 1 / -1; height: 1px; background: var(--border); margin: 16px 0px 8px;"></div>
        <div class="ts-expected-section-title" style="grid-column: 1 / -1; font-weight: 600; margin: 8px 0px 4px;">Projections</div>
      </div>
      <div class="ts-income-row income-potential-row" id="income-potential-net-row" hidden>
        <span class="ts-income-row-label">Net income if working standard hours every day</span>
        <span class="ts-income-row-actual"></span>
        <span class="ts-income-row-est" id="income-potential-net">--</span>
      </div>
      <div class="ts-income-row income-potential-row" id="income-estimated-standard-row" hidden>
        <span class="ts-income-row-label">
          Estimated net income (standard hours)
          <span class="ts-info-icon" id="income-estimated-standard-info" title="Hours used: --">i</span>
        </span>
        <span class="ts-income-row-actual"></span>
        <span class="ts-income-row-est" id="income-estimated-standard-net">--</span>
      </div>
      <div class="ts-income-row income-potential-row" id="income-estimated-projected-row" hidden>
        <span class="ts-income-row-label">
          Estimated net income (projected hours)
          <span class="ts-info-icon" id="income-estimated-projected-info" title="Hours used: --">i</span>
        </span>
        <span class="ts-income-row-actual"></span>
        <span class="ts-income-row-est" id="income-estimated-projected-net">--</span>
      </div>
      <div id="hourly-rate-divider" class="ts-income-divider" hidden></div>
      <div class="ts-income-row" id="hourly-rate-gross-row" hidden>
        <span class="ts-income-row-label">Gross income hourly rate based on <span id="hourly-rate-gross-label">--</span>:</span>
        <span class="ts-income-row-actual"></span>
        <span class="ts-income-row-est" id="income-hourly-rate-gross">--</span>
      </div>
      <div class="ts-income-row" id="hourly-rate-net-row" hidden>
        <span class="ts-income-row-label">Net income hourly rate based on <span id="hourly-rate-net-label">--</span>:</span>
        <span class="ts-income-row-actual"></span>
        <span class="ts-income-row-est" id="income-hourly-rate-net">--</span>
      </div>
    </div>
    <div class="ts-expected-breakdown" id="expected-hours-breakdown" hidden>
      <div id="expected-hours-content"></div>
    </div>
    <div class="ts-calendar-grid" id="calendar-weekdays">
      <div class="ts-calendar-weekday">Mon</div>
      <div class="ts-calendar-weekday">Tue</div>
      <div class="ts-calendar-weekday">Wed</div>
      <div class="ts-calendar-weekday">Thu</div>
      <div class="ts-calendar-weekday">Fri</div>
      <div class="ts-calendar-weekday">Sat</div>
      <div class="ts-calendar-weekday">Sun</div>
    </div>
    <div class="ts-calendar-grid" id="calendar-grid"></div>
    <div class="ts-calendar-context-menu" id="calendar-context-menu" style="display:none;">
      <div class="ts-calendar-context-header">Add default entry</div>
      <div class="ts-calendar-context-empty" id="calendar-context-empty" style="display:none;">
        Create a basic or advanced default to use this shortcut.
      </div>
      <div class="ts-calendar-context-section" data-section="basic">
        <div class="ts-calendar-context-title">Basic defaults</div>
        <div class="ts-calendar-context-list" id="calendar-context-basic"></div>
      </div>
      <div class="ts-calendar-context-section" data-section="advanced">
        <div class="ts-calendar-context-title">Advanced defaults</div>
        <div class="ts-calendar-context-list" id="calendar-context-advanced"></div>
      </div>
    </div>
    <div class="ts-note" style="margin-top:6px;">Click a day to add or edit entries. Right-click to insert a default.</div>
    <div class="ts-payroll-helper-actions" id="payroll-helper-actions">
      <button class="ghost" id="calendar-xero-helper" type="button" style="display:none;">Xero Payroll Helper</button>
      <button class="ghost" id="calendar-myob-helper" type="button" style="display:none;">MYOB Payroll Helper</button>
      <button class="ghost" id="calendar-actual-income-btn" type="button" style="display:none;">Add Actual Income</button>
      <button class="ghost" id="btn-manage-recurring" type="button" style="display:none;">Reoccurring Entries</button>
      <button class="ghost" id="btn-manage-bulk" type="button" style="display:none;">Bulk Entries</button>
      <button class="ghost" id="calendar-print-monthly-btn" type="button" style="display:none;">Print Monthly Hours</button>
      <button class="ghost" id="btn-timesheet1-importer" type="button" style="display:none;">Import Timesheet 1.0</button>
    </div>
  </div>
</section>

<!-- Actual Income Modal -->
<div class="ts-modal" id="modal-actual-income" style="display:none;">
  <div class="ts-modal-content">
    <div class="ts-modal-header">
      <h3 id="actual-income-title">Add Actual Income</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <div style="text-align:center; font-size:18px; font-weight:600; margin-bottom:16px; padding:12px; background:var(--bg); border-radius:8px;" id="actual-income-month-display">
        October 2025
      </div>
      <input type="hidden" id="actual-income-month" />
      <div class="ts-grid ts-grid--gap-md" style="margin-top:12px;">
        <div class="ts-col-span-6">
          <label>Gross Income</label>
          <input type="number" id="actual-income-gross" min="0" step="0.01" placeholder="0.00" />
        </div>
        <div class="ts-col-span-6">
          <label>Superannuation</label>
          <input type="number" id="actual-income-super" min="0" step="0.01" placeholder="0.00" />
        </div>
      </div>
      <div class="ts-grid ts-grid--gap-md" style="margin-top:12px;">
        <div class="ts-col-span-6">
          <label>Tax</label>
          <input type="number" id="actual-income-tax" min="0" step="0.01" placeholder="0.00" />
        </div>
        <div class="ts-col-span-6">
          <label>Net Income</label>
          <input type="number" id="actual-income-net" min="0" step="0.01" placeholder="0.00" />
        </div>
      </div>
      <div class="ts-note" style="margin-top:12px;">Enter the actual amounts from your payslip or bank statement. This allows comparison with the estimated values calculated by the app.</div>
    </div>
    <div class="ts-modal-footer">
      <button class="ghost" id="btn-delete-actual-income" style="display:none; margin-right:auto;">Delete</button>
      <button class="ghost" id="btn-cancel-actual-income">Cancel</button>
      <button id="btn-save-actual-income">Save</button>
    </div>
  </div>
</div>

<!-- Timesheet 1.0 Importer Modal -->
<div class="ts-modal" id="modal-timesheet1-importer" style="display:none;">
  <div class="ts-modal-content" style="max-width: 720px;">
    <div class="ts-modal-header">
      <h3>Timesheet 1.0 Importer</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <p class="ts-note" style="margin-bottom:12px;">
        Paste the Google Sheets file ID for your legacy Timesheet 1.0 workbook. You can copy it from the Drive URL: the long string between <code>/d/</code> and <code>/edit</code>.
      </p>
      <label>Spreadsheet File ID</label>
      <input type="text" id="timesheet1-file-id" placeholder="e.g. 1AbC2dEf3GhijkLMNOP4qr5stUV6wxYZ" />
      <div class="ts-note" id="timesheet1-status" style="margin:8px 0 12px 0;"></div>
      <div class="ts-inline-actions" style="gap:8px; flex-wrap:wrap;">
        <button class="ghost" id="btn-timesheet1-preview">Preview Import</button>
        <button class="primary" id="btn-timesheet1-run" disabled>Import Entries</button>
        <button class="ghost" id="btn-timesheet1-cancel">Close</button>
      </div>
      <div style="margin-top:12px; display:flex; align-items:center; gap:8px;">
        <label class="ts-toggle">
          <input type="checkbox" id="timesheet1-skip-holidays" checked />
          <span class="ts-toggle-track"><span class="ts-toggle-thumb"></span></span>
        </label>
        <div>
          <div style="font-weight:600;">Skip public holidays</div>
          <div class="ts-note">Exclude entries on public holidays (will fetch holidays for the relevant years if missing).</div>
        </div>
      </div>
      <div id="timesheet1-mapping-section" style="margin-top:16px; display:none;">
        <div class="ts-section-header">
          <h4>Hour Type Mapping</h4>
          <div class="ts-note">Match hour type labels in the legacy sheet to current hour types.</div>
        </div>
        <div id="timesheet1-mapping-list" class="ts-stack ts-stack--sm"></div>
      </div>
      <div id="timesheet1-contract-section" style="margin-top:16px; display:none;">
        <div class="ts-section-header">
          <h4>Contract Selection</h4>
          <div class="ts-note">For hour types that require contracts, pick the contract to use for the entire month.</div>
        </div>
        <div id="timesheet1-contract-list" class="ts-stack ts-stack--sm"></div>
      </div>
      <div id="timesheet1-preview-section" style="margin-top:16px; display:none;">
        <div class="ts-section-header">
          <h4>Preview</h4>
          <div class="ts-note">Counts exclude day/hour type combinations that already exist in Tempus.</div>
        </div>
        <div id="timesheet1-preview-summary"></div>
      </div>
      <div id="timesheet1-import-summary" style="margin-top:12px; display:none;"></div>
    </div>
  </div>
</div>

<!-- Payroll Helper Modals -->
<div class="ts-modal" id="modal-xero-helper" style="display:none;">
  <div class="ts-modal-content" style="max-width: 720px;">
    <div class="ts-modal-header">
      <h3>Xero Payroll Helper</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <div id="xero-helper-content"></div>
    </div>
    <div class="ts-modal-footer">
      <button class="ghost" id="btn-close-xero-helper">Close</button>
    </div>
  </div>
</div>

<div class="ts-modal" id="modal-myob-helper" style="display:none;">
  <div class="ts-modal-content" style="max-width: 720px;">
    <div class="ts-modal-header">
      <h3>MYOB Payroll Helper</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <div id="myob-helper-content"></div>
    </div>
    <div class="ts-modal-footer">
      <button class="ghost" id="btn-close-myob-helper">Close</button>
    </div>
  </div>
</div>

<!-- Monthly Deductions Details Modal -->
<div class="ts-modal" id="modal-monthly-deductions" style="display:none;">
  <div class="ts-modal-content" style="max-width:720px;">
    <div class="ts-modal-header">
      <h3 id="monthly-deductions-title">Monthly Deductions</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <div id="monthly-deductions-content"></div>
    </div>
    <div class="ts-modal-footer">
      <button class="ghost" id="btn-close-monthly-deductions">Close</button>
    </div>
  </div>
</div>

<!-- Adjust Occurrence Modal -->
<div class="ts-modal" id="modal-adjust-occurrence" style="display:none;">
  <div class="ts-modal-content" style="max-width:500px;">
    <div class="ts-modal-header">
      <h3>Adjust Occurrence</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <div class="ts-note" style="margin-bottom:16px;">
        <strong id="adjust-deduction-name"></strong><br>
        Original: <span id="adjust-original-date"></span> - <span id="adjust-original-amount"></span>
      </div>

      <div style="margin-bottom:16px;">
        <label for="adjust-new-date" style="display:block; margin-bottom:4px;">Move to different date (optional)</label>
        <input type="date" id="adjust-new-date" style="width:100%;">
      </div>

      <div style="margin-bottom:16px;">
        <label for="adjust-new-amount" style="display:block; margin-bottom:4px;">Adjust amount (optional)</label>
        <input type="number" id="adjust-new-amount" step="0.01" min="0" style="width:100%;">
      </div>

      <div style="margin-bottom:16px;">
        <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
          <input type="checkbox" id="adjust-skip">
          <span>Skip this occurrence</span>
        </label>
        <div class="ts-note" style="margin-top:4px;">When checked, date and amount fields are ignored</div>
      </div>

      <div>
        <label for="adjust-notes" style="display:block; margin-bottom:4px;">Notes (optional)</label>
        <textarea id="adjust-notes" rows="2" style="width:100%;"></textarea>
      </div>
    </div>
    <div class="ts-modal-footer">
      <button class="ghost" id="btn-delete-exception" style="display:none; margin-right:auto;">Remove Adjustment</button>
      <button class="ghost" id="btn-cancel-adjust">Cancel</button>
      <button id="btn-save-exception">Save Adjustment</button>
    </div>
  </div>
</div>

<!-- Default Entry Modals -->
<div class="ts-modal" id="modal-create-default" style="display:none;">
  <div class="ts-modal-content">
    <div class="ts-modal-header">
      <h3>Create Default Entry</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <div class="ts-grid ts-grid--gap-md">
        <div class="ts-col-span-12">
          <label>Default Name</label>
          <input type="text" id="default-name" placeholder="e.g., Regular Day, Split Day" />
        </div>
        <div class="ts-col-span-12" id="default-hour-type-row" style="display:none;">
          <label>Hour type (optional)</label>
          <select id="default-hour-type"></select>
          <small class="ts-note">Leave blank to respect whatever hour type is currently selected when applying this default.</small>
        </div>
      </div>
    </div>
    <div class="ts-modal-footer">
      <button class="ghost" id="btn-cancel-create-default">Cancel</button>
      <button id="btn-save-default">Save Default</button>
    </div>
  </div>
</div>

<div class="ts-modal" id="modal-select-default" style="display:none;">
  <div class="ts-modal-content">
    <div class="ts-modal-header">
      <h3>Select Default Entry</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <div id="default-selection-list" class="ts-default-list"></div>
    </div>
    <div class="ts-modal-footer">
      <button class="ghost" id="btn-cancel-select-default">Cancel</button>
    </div>
  </div>
</div>

<div class="ts-modal" id="modal-edit-defaults" style="display:none;">
  <div class="ts-modal-content" style="max-width: 600px;">
    <div class="ts-modal-header">
      <h3>Edit Defaults</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <div id="edit-defaults-list" class="ts-edit-defaults-list"></div>
      <div class="ts-note" style="margin-top:16px;">Click on a default to edit its details, or use the delete button to remove it.</div>
    </div>
    <div class="ts-modal-footer">
      <button id="btn-close-edit-defaults">Close</button>
    </div>
  </div>
</div>

<div class="ts-modal" id="modal-edit-default-details" style="display:none;">
  <div class="ts-modal-content">
    <div class="ts-modal-header">
      <h3>Edit Default Details</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <div class="ts-grid ts-grid--gap-md">
        <div class="ts-col-span-12">
          <label>Default Name</label>
          <input type="text" id="edit-default-name" />
        </div>
        <div class="ts-col-span-12" id="edit-default-hour-type-row" style="display:none;">
          <label>Hour type (optional)</label>
          <select id="edit-default-hour-type"></select>
          <small class="ts-note">Blank = use the hour type currently selected on the manual or punch form.</small>
        </div>
      </div>
      <div id="edit-default-form" style="margin-top:16px;">
        <!-- Dynamic content based on default type -->
      </div>
    </div>
    <div class="ts-modal-footer">
      <button class="ghost" id="btn-cancel-edit-default-details">Cancel</button>
      <button id="btn-save-default-details">Save Changes</button>
    </div>
  </div>
</div>

<div class="ts-modal" id="modal-recurring-entries" style="display:none;">
  <div class="ts-modal-content" style="max-width:960px;">
    <div class="ts-modal-header">
      <h3>Manage Reoccurring Entries</h3>
      <button class="ts-modal-close" aria-label="Close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <div class="ts-grid ts-grid--gap-lg ts-grid--align-start">
        <div class="ts-col-span-5">
          <div class="ts-gap-sm" style="display:flex; justify-content:flex-end; align-items:center;">
            <button id="btn-recurring-new">New Schedule</button>
          </div>
          <div id="recurring-entry-list" class="ts-gap-sm" style="margin-top:12px;"></div>
          <div class="ts-empty" id="recurring-entry-empty" style="display:none; margin-top:24px;">
            <p style="margin:0;">No reoccurring schedules yet. Create one to automatically add future entries.</p>
          </div>
        </div>
        <div class="ts-col-span-7">
          <div id="recurring-entry-form" class="ts-card" style="display:flex; flex-direction:column; gap:12px;">
            <div>
              <h4 id="recurring-form-title" style="margin:0;">New Schedule</h4>
              <p class="ts-note" id="recurring-form-subtitle" style="margin:4px 0 0;">Define cadence and contract limits.</p>
            </div>
            <div class="ts-warning" id="recurring-form-warning" style="display:none;"></div>
            <label>Name<input type="text" id="recurring-name" placeholder="e.g., Parental leave" /></label>
            <div class="ts-grid ts-grid--gap-md">
              <div class="ts-col-span-6">
                <label>Hours per occurrence<input type="number" id="recurring-hours" min="0.25" step="0.25" placeholder="e.g., 7.5" /></label>
              </div>
              <div class="ts-col-span-6">
                <label>Contract
                  <select id="recurring-contract"></select>
                </label>
              </div>
            </div>
            <div id="recurring-hour-type-row" style="display:none;">
              <label>Hour type
                <select id="recurring-hour-type"></select>
              </label>
            </div>
            <div class="ts-grid ts-grid--gap-md">
              <div class="ts-col-span-6">
                <label>Start date<input type="date" id="recurring-start-date" /></label>
              </div>
              <div class="ts-col-span-6">
                <label>End date (optional)<input type="date" id="recurring-end-date" /></label>
              </div>
            </div>
            <label>Cadence
              <select id="recurring-frequency">
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
              </select>
            </label>
            <div id="recurring-weekly-fields">
              <div class="ts-grid ts-grid--gap-md">
                <div class="ts-col-span-6">
                  <label>Repeat every<input type="number" id="recurring-weekly-interval" min="1" step="1" value="1" /></label>
                  <small class="ts-note">Number of weeks between runs</small>
                </div>
              </div>
            </div>
            <div id="recurring-monthly-fields" class="ts-stack" style="display:none;">
              <label>Repeat every<input type="number" id="recurring-monthly-interval" min="1" step="1" value="1" /></label>
              <small class="ts-note">Number of months between runs</small>
              <div class="ts-grid ts-grid--gap-md ts-grid--align-start" style="margin-top:8px; grid-template-columns: repeat(2, minmax(0, 1fr));">
                <div id="recurring-monthly-mode-wrapper" class="ts-stack" style="gap:8px;">
                  <label>Schedule type</label>
                  <select id="recurring-monthly-mode">
                    <option value="day_of_month">Specific day of month</option>
                    <option value="weekday_of_month">Weekday position</option>
                  </select>
                </div>
                <div id="recurring-monthly-detail-wrapper" class="ts-stack" style="gap:8px;">
                  <div id="recurring-monthly-day-wrapper">
                    <label>Day of month</label>
                    <input type="number" id="recurring-monthly-day" min="1" max="31" step="1" />
                  </div>
                  <div id="recurring-monthly-week-wrapper" style="display:none;">
                    <label>Week & weekday</label>
                    <div class="ts-grid ts-grid--gap-sm" style="grid-template-columns: repeat(2, minmax(0, 1fr));">
                      <select id="recurring-monthly-week">
                        <option value="1">First</option>
                        <option value="2">Second</option>
                        <option value="3">Third</option>
                        <option value="4">Fourth</option>
                        <option value="5">Last</option>
                      </select>
                      <select id="recurring-monthly-weekday">
                        <option value="1">Monday</option>
                        <option value="2">Tuesday</option>
                        <option value="3">Wednesday</option>
                        <option value="4">Thursday</option>
                        <option value="5">Friday</option>
                        <option value="6">Saturday</option>
                        <option value="0">Sunday</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="ts-note" id="recurring-generated-summary" style="display:none;"></div>
            <div class="ts-note" id="recurring-preview-note" style="display:none;">
              <strong>Next occurrences</strong>
              <ul id="recurring-preview-list" style="margin:4px 0 0; padding-left:16px;"></ul>
            </div>
            <div class="ts-error" id="recurring-form-error" style="display:none;"></div>
            <div class="ts-gap-sm" style="display:flex; flex-wrap:wrap; gap:8px; justify-content:flex-end;">
              <button class="ghost" id="btn-cancel-recurring">Close</button>
              <button class="ghost danger" id="btn-delete-recurring" style="display:none;">Delete Schedule</button>
              <button id="btn-save-recurring">Add Schedule</button>
            </div>
            <div id="recurring-delete-confirm" class="ts-warning" style="display:none;">
              <p style="margin-top:0;">Delete this schedule? Existing entries remain unless you remove future ones using the button above.</p>
              <div class="ts-gap-sm" style="display:flex; gap:8px; justify-content:flex-end;">
                <button class="ghost" id="btn-cancel-delete-recurring">Cancel</button>
                <button class="danger" id="btn-confirm-delete-recurring">Confirm delete</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="ts-modal" id="modal-bulk-entries" style="display:none;">
  <div class="ts-modal-content" style="max-width:960px;">
    <div class="ts-modal-header">
      <h3>Manage Bulk Entries</h3>
      <button class="ts-modal-close" aria-label="Close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <div class="ts-grid ts-grid--gap-lg ts-grid--align-start">
        <div class="ts-col-span-5">
          <div class="ts-gap-sm" style="display:flex; justify-content:flex-end; align-items:center;">
            <button id="btn-bulk-new">New Bulk Range</button>
          </div>
          <div id="bulk-entry-list" class="ts-gap-sm" style="margin-top:12px;"></div>
          <div class="ts-empty" id="bulk-entry-empty" style="display:none; margin-top:24px;">
            <p style="margin:0;">No bulk ranges yet. Create one to add consistent entries between two dates.</p>
          </div>
        </div>
        <div class="ts-col-span-7">
          <div id="bulk-entry-form" class="ts-card" style="display:flex; flex-direction:column; gap:12px;">
            <div>
              <h4 id="bulk-form-title" style="margin:0;">New Bulk Range</h4>
              <p class="ts-note" id="bulk-form-subtitle" style="margin:4px 0 0;">Fill a date range with matching entries.</p>
            </div>
            <div class="ts-warning" id="bulk-form-warning" style="display:none;"></div>
            <div class="ts-grid ts-grid--gap-md" style="grid-template-columns:minmax(0,1fr) minmax(0,1fr); align-items:flex-end;">
              <div>
                <label>Name<input type="text" id="bulk-name" placeholder="e.g., Overseas Holiday" /></label>
              </div>
              <div>
                <label>Distribution
                  <select id="bulk-distribution-mode">
                    <option value="daily">Hours each day</option>
                    <option value="monthly">Hours over the month</option>
                  </select>
                </label>
              </div>
            </div>
            <div class="ts-grid ts-grid--gap-md">
              <div class="ts-col-span-6">
                <label id="bulk-hours-label">
                  <span id="bulk-hours-label-text">Hours per day</span>
                  <input type="number" id="bulk-hours" min="0.25" step="0.25" placeholder="e.g., 7.5" />
                </label>
              </div>
              <div class="ts-col-span-6">
                <label>Contract
                  <select id="bulk-contract"></select>
                </label>
              </div>
            </div>
            <div id="bulk-hour-type-row" style="display:none;">
              <label>Hour type
                <select id="bulk-hour-type"></select>
              </label>
            </div>
            <div id="bulk-month-wrapper" style="display:none;">
              <div class="ts-field-group">
                <label>Month</label>
                <input type="hidden" id="bulk-month" />
                <div class="ts-month-picker-card" style="border:1px solid var(--border); border-radius:12px; padding:12px;">
                  <div class="ts-month-picker-header" style="margin-bottom:12px;">
                    <button type="button" class="ghost small" id="bulk-month-year-prev">◀</button>
                    <div id="bulk-month-year" class="ts-month-picker-year" style="font-size:16px;">2025</div>
                    <button type="button" class="ghost small" id="bulk-month-year-next">▶</button>
                  </div>
                  <div class="ts-month-picker-grid" id="bulk-month-grid"></div>
                </div>
              </div>
            </div>
            <div class="ts-grid ts-grid--gap-md" id="bulk-date-range-row">
              <div class="ts-col-span-6" id="bulk-start-date-wrapper">
                <label>Start date<input type="date" id="bulk-start-date" /></label>
              </div>
              <div class="ts-col-span-6" id="bulk-end-date-wrapper">
                <label>End date<input type="date" id="bulk-end-date" /></label>
              </div>
            </div>
            <div class="ts-stack" style="gap:8px;">
              <label class="ts-toggle">
                <input type="checkbox" id="bulk-skip-weekends" checked />
                <span class="ts-toggle-track"><span class="ts-toggle-thumb"></span></span>
                <span>Skip weekends</span>
              </label>
              <label class="ts-toggle">
                <input type="checkbox" id="bulk-skip-holidays" checked />
                <span class="ts-toggle-track"><span class="ts-toggle-thumb"></span></span>
                <span>Skip public holidays</span>
              </label>
            </div>
            <div class="ts-note" id="bulk-generated-summary" style="display:none;"></div>
            <div class="ts-error" id="bulk-form-error" style="display:none;"></div>
            <div class="ts-gap-sm" style="display:flex; flex-wrap:wrap; gap:8px; justify-content:flex-end;">
              <button class="ghost" id="btn-cancel-bulk">Close</button>
              <button class="ghost danger" id="btn-delete-bulk" style="display:none;">Delete Range</button>
              <button id="btn-save-bulk">Save Range</button>
            </div>
            <div id="bulk-delete-confirm" class="ts-warning" style="display:none;">
              <p style="margin-top:0;">Delete this bulk range? All generated entries will also be removed.</p>
              <div class="ts-gap-sm" style="display:flex; gap:8px; justify-content:flex-end;">
                <button class="ghost" id="btn-cancel-delete-bulk">Cancel</button>
                <button class="danger" id="btn-confirm-delete-bulk">Confirm delete</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Reusable Confirm Modal -->
<div class="ts-modal" id="modal-confirm" style="display:none;">
  <div class="ts-modal-content" style="max-width: 480px;">
    <div class="ts-modal-header">
      <h3 id="confirm-title">Confirm</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <p id="confirm-message" style="margin:0;"></p>
    </div>
    <div class="ts-modal-footer">
      <button class="ghost" id="btn-confirm-cancel">Cancel</button>
      <button id="btn-confirm-ok">OK</button>
    </div>
  </div>
</div>

<!-- Reusable Alert Modal -->
<div class="ts-modal" id="modal-alert" style="display:none;">
  <div class="ts-modal-content" style="max-width: 480px;">
    <div class="ts-modal-header">
      <h3 id="alert-title">Notice</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <p id="alert-message" style="margin:0;"></p>
    </div>
    <div class="ts-modal-footer">
      <button id="btn-alert-ok">OK</button>
    </div>
  </div>
</div>

<!-- BAS Detail Modal -->
<div class="ts-modal" id="modal-bas-detail" style="display:none;">
  <div class="ts-modal-content" style="max-width: 680px;">
    <div class="ts-modal-header">
      <h3 id="bas-detail-title">BAS Details</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <p class="ts-note" style="margin:0 0 16px 0;">Click any field to copy its value to the clipboard</p>

      <div style="margin-bottom:24px;">
        <h4 style="margin:0 0 12px 0; font-size:15px; font-weight:600;">Goods and Services Tax (GST)</h4>
        <div style="display:flex; flex-direction:column; gap:12px;">
          <div class="bas-field-row">
            <label class="bas-field-label">G1 - Total Sales</label>
            <div class="bas-field-value" id="bas-g1-value" data-field="g1" title="Click to copy">$0.00</div>
          </div>
          <div class="bas-field-row">
            <label class="bas-field-label" style="padding-left:20px;">Does this include GST?</label>
            <div class="bas-field-value" id="bas-g1-gst" data-field="g1_gst">Yes</div>
          </div>
          <div class="bas-field-row">
            <label class="bas-field-label">1A - GST on Sales</label>
            <div class="bas-field-value" id="bas-1a-value" data-field="1a" title="Click to copy">$0.00</div>
          </div>
          <div class="bas-field-row">
            <label class="bas-field-label">1B - GST on Purchases</label>
            <div class="bas-field-value" id="bas-1b-value" data-field="1b" title="Click to copy">$0.00</div>
          </div>
        </div>
      </div>

      <div style="margin-bottom:24px;">
        <h4 style="margin:0 0 12px 0; font-size:15px; font-weight:600;">PAYG Income Tax Instalment</h4>
        <p class="ts-note" style="margin:0 0 12px 0; font-size:12px;">Calculate PAYG instalment using income times rate</p>
        <div style="display:flex; flex-direction:column; gap:12px;">
          <div class="bas-field-row">
            <label class="bas-field-label">T1 - PAYG Instalment Income</label>
            <div class="bas-field-value" id="bas-t1-value" data-field="t1" title="Click to copy">$0.00</div>
          </div>
          <div class="bas-field-row">
            <label class="bas-field-label">T2 - Instalment Rate (%)</label>
            <div class="bas-field-value" id="bas-t2-value" data-field="t2" title="Click to copy">0.00%</div>
          </div>
        </div>
      </div>

      <div style="display:flex; align-items:center; justify-content:center; padding:16px; background:var(--panel); border-radius:8px; border:1px solid var(--border);">
        <label style="display:flex; align-items:center; gap:12px; cursor:pointer; user-select:none;">
          <input type="checkbox" id="bas-submitted-toggle" style="width:18px; height:18px; cursor:pointer;">
          <span style="font-weight:600;">BAS Submitted for this period</span>
        </label>
      </div>
    </div>
    <div class="ts-modal-footer">
      <button class="ghost" id="btn-bas-detail-close">Close</button>
      <button id="btn-bas-detail-save">Save</button>
    </div>
  </div>
</div>

<style>
.bas-field-row {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 16px;
  align-items: center;
}

.bas-field-label {
  font-size: 13px;
  color: var(--muted);
}

.bas-field-value {
  font-size: 15px;
  font-weight: 600;
  font-variant-numeric: tabular-nums;
  padding: 8px 12px;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s ease;
  text-align: right;
}

.bas-field-value:hover {
  background: var(--bg);
  border-color: var(--primary);
}

.bas-field-value:active {
  transform: scale(0.98);
}

.bas-field-value.copied {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}
</style>

<!-- Month Picker Modal -->
<div class="ts-modal" id="modal-month-picker" style="display:none;">
  <div class="ts-modal-content" style="max-width: 420px;">
    <div class="ts-modal-header">
      <h3>Jump to Month</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <div class="ts-month-picker-header">
        <button class="ghost" id="month-picker-year-prev">◀</button>
        <div id="month-picker-year-display" class="ts-month-picker-year">2025</div>
        <button class="ghost" id="month-picker-year-next">▶</button>
      </div>

      <div class="ts-month-picker-grid" id="month-picker-grid">
        <!-- Months will be generated by JavaScript -->
      </div>
    </div>
  </div>
</div>

<!-- Monthly Print View Modal -->
<div class="ts-modal" id="modal-print-view-config" style="display:none;">
  <div class="ts-modal-content" style="max-width: 540px;">
    <div class="ts-modal-header">
      <h3>Select Hour Types for Print View</h3>
      <button class="ts-modal-close">&times;</button>
    </div>
    <div class="ts-modal-body">
      <div class="ts-note" style="margin-bottom:16px;">
        Select which hour types to include in the print view. Choose at least one income hour type (they will be summed together) and up to two non-income hour types so the layout fits on a single A4 page.
      </div>
      <div id="print-view-income-types" style="margin-bottom:16px;">
        <h4 style="margin:0 0 8px 0; font-size:13px; font-weight:600; color:var(--muted);">Income-Generating Hours</h4>
        <div id="print-view-income-list" style="display:flex; flex-direction:column; gap:4px;">
          <!-- Populated by JavaScript -->
        </div>
      </div>
      <div id="print-view-other-types">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
          <h4 style="margin:0; font-size:13px; font-weight:600; color:var(--muted);">Other Hour Types</h4>
          <button class="ghost" id="btn-unselect-all-other" style="font-size:12px; padding:4px 8px;">Unselect all</button>
        </div>
        <div id="print-view-other-list" style="display:flex; flex-direction:column; gap:4px;">
          <!-- Populated by JavaScript -->
        </div>
      </div>
      <div class="ts-warning" id="print-view-warning" style="display:none; margin-top:12px;">
        <span id="print-view-warning-text"></span>
      </div>
    </div>
    <div class="ts-modal-footer">
      <button class="ghost" id="btn-cancel-print-view">Cancel</button>
      <button id="btn-generate-print-view">Generate Print View</button>
    </div>
  </div>
</div>
